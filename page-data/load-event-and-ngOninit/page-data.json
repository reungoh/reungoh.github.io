{"componentChunkName":"component---src-templates-blog-post-js","path":"/load-event-and-ngOninit/","result":{"data":{"site":{"siteMetadata":{"title":"reungoh's log"}},"markdownRemark":{"id":"649b3862-bda8-5aab-8e98-ddab8c01b023","excerpt":"단순한 문제였는데, 몇시간을 좀 헤맸다. 결론은 window 의 onLoad 이벤트는 가장 나중에 실행된다. 팀내에서는 앵귤러로 UI를 개발하고 있다.\r\n새로운 윈도우를 띄워서 보여주어야 할 화면이 있었다.\r\n지금 생각해보면 굳이 새창으로 띄우지 않고 모달로 띄우는 것이 SPA…","html":"<p>단순한 문제였는데, 몇시간을 좀 헤맸다.<br>\n결론은 <b>window 의 onLoad 이벤트는 가장 나중에 실행된다.</b></p>\n<p>팀내에서는 앵귤러로 UI를 개발하고 있다.\r\n새로운 윈도우를 띄워서 보여주어야 할 화면이 있었다.\r\n지금 생각해보면 굳이 새창으로 띄우지 않고 모달로 띄우는 것이 SPA 에 잘 어울릴것 같은데,\r\n기존에 새창으로 띄우도록 구현되어 있어 뒤엎을 생각을 하지 못했다.</p>\n<p>새로운 창에 데이터를 전달해야 했고,\r\npostMessage 메소드를 이용하는 방법과 localStorage 를 이용하는 방법이 떠올랐다. 로컬스토리지를 사용하는 방법은 피하고 싶었다. 써본적 없지만 postMessage 메소드를 써보기로 했다.</p>\n<p>처음에는 아래와 같이 코드를 작성했다.\r\n<br/><br/></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 부모 윈도우 컴포넌트</span>\r\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token function\">serializeUrl</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token function\">createUrlTree</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'/url...'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">const</span> childWindow <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'_blank'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    childWindow<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"message...\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>protocol <span class=\"token operator\">+</span> <span class=\"token string\">\"//\"</span> <span class=\"token operator\">+</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 자식 윈도우 컴포넌트</span>\r\n<span class=\"token function\">ngOnInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span> \r\n<span class=\"token operator\">...</span>\r\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"message\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">===</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>protocol <span class=\"token operator\">+</span> <span class=\"token string\">\"//\"</span> <span class=\"token operator\">+</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>host <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// ...</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">...</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><br/><br/>\r\n부모창에서 전달한 메세지가 자식창에게 전달되지 않았다.\r\n컴포넌트 라이프라이프 사이클 문제일까 싶어서 constroctor()에 메세지를 수신하는 코드를 작성해 봤지만 동일하게 메세지가 수신되지 않았다.\r\nMDN 공식문서를 다시 천천히 읽어보다가 멈칫했다.<br>\n<br/><br/>\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5bb8bd6ddc5d78589671adcff65af861/cc8d6/mdn_refer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABVUlEQVR42qVS2VLCQBDk/79PwEc1x95HsgGkQNqeBaG0Ipaaqq6Znd3p9ByL9WqFh+US6/UjcDrhv98ixoQQI3IecTgc/4Tj8Q2lTNjv91gMecBmmjCVgmEYMOQ8g3N85P13SBS13W6p0HsEwjuHEAKstTw7RPoSFyt3knCPUPC622EhJJmPJSHRH1KqvhCJ/UnZB+TdTgi1cbBawxoD3ysk62Doa6VqLPMHvyIUVaIyiiomOxLKpfR1w0ZPY6n9LaNgrLhLKCqc0nBUZ6jUWKoTxc5WpWK10RVyZ4m5NtxKZmmp18iNQte3eDYtGtPhRbd40g1tg86yfA5Ke8MV87Mqr4Q1UPiAZaUUmRBqkg++kkgrSr4kpfMazQ3rk0LVtlAN0Xdo2oa2r+h59iR1zt5W62K/rtGV0JAwK/allalq9CzLeAsXziUqx/4Fw4HFa6n3Sn4HEhSSmMn/a8sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"mdn\"\n        title=\"\"\n        src=\"/static/5bb8bd6ddc5d78589671adcff65af861/f058b/mdn_refer.png\"\n        srcset=\"/static/5bb8bd6ddc5d78589671adcff65af861/c26ae/mdn_refer.png 158w,\n/static/5bb8bd6ddc5d78589671adcff65af861/6bdcf/mdn_refer.png 315w,\n/static/5bb8bd6ddc5d78589671adcff65af861/f058b/mdn_refer.png 630w,\n/static/5bb8bd6ddc5d78589671adcff65af861/cc8d6/mdn_refer.png 791w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n<br/><br/>\r\n<b>\"팝업이 완전히 로드되었을 때\"</b><br/><br/>\r\n프레임워크의 이벤트에서만 문제를 찿고 있었다. postMessage는 window의 이벤트이다.\r\n앵귤러의 라이프사이클과 window의 이벤트는 별개로 동작한다.\r\n아래처럼 자식창의 load 이벤트 후에 메세지를 전송하도록 수정했다.\r\n<br/><br/></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token function\">serializeUrl</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>router<span class=\"token punctuation\">.</span><span class=\"token function\">createUrlTree</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'/url...'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> childWindow <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'_blank'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\nchildWindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'load'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    childWindow<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"messasge...\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>protocol <span class=\"token operator\">+</span> <span class=\"token string\">\"//\"</span> <span class=\"token operator\">+</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><br/><br/></p>\n<h5>앵귤러의 라이프 사이클은 Window 이벤트와 별개로 동작한다.</h5>\n<p>당연한 이야기이지만 인지하고 있지 않으면 또 비슷한 실수를 할 수 있을 것 같다.<br>\n앵귤러의 라이프사이클은 컴포넌트의 생성, 렌더링, 삭제 단계에서의 동작을 정의한다.\r\n브라우저의 window 객체는 웹페이지에서 발생하는 브라우저의 동작과 관련된 이벤트들을 다룬다.</p>\n<p><b>onload</b>는 브라우저의 'window' 객체의 이벤트이다.<br>\n브라우저가 페이지의 모든 리소스를 로드하면 발생하는 이벤트로 js, css, assets 등 모든 리소스가 로드되고, 페이지가 완전히 화면에 그려진 후에 트리거된다.</p>\n<p><b>constructor, ngOninit</b>는 앵귤러의 라이프사이클 메소드로 앵귤러의 컴포넌트는 자바스크립트 클래스의 인스턴스이다.\r\n인스턴스가 생성될 때, constructor가 실행되고, 프로퍼티를 초기화 하고 화면을 그리기 전에 ngOnInit이 실행된다.</p>\n<p>새로운 자식창의 리소스가 로드가 되기도 전에, DOM 트리를 그리기도 전에 메세지를 보내놓고,\r\n메세지를 받는 코드의 시점을 두고 헤맸던 것이다.</p>\n<p>조금더 기본에 충실하고, 공식문서를 꼼꼼이 읽자</p>","frontmatter":{"title":"load, ngOnInit 의 호출 순서","date":"December 16, 2023","description":"window load, ngOnInit","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHcWQgL/8QAFxABAAMAAAAAAAAAAAAAAAAAARIgIf/aAAgBAQABBQJUZbT/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAASAhMv/aAAgBAQAGPwKkZaj/AP/EABkQAQACAwAAAAAAAAAAAAAAAAEAESAhUf/aAAgBAQABPyEwWXBaIOuP/9oADAMBAAIAAwAAABCfz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EKf/xAAdEAABAgcAAAAAAAAAAAAAAAABACERIDFRcbHw/9oACAEBAAE/EDCRqNudFYI0NoOJP//Z","aspectRatio":1.7699115044247788,"src":"/static/377d8b408af8c1a5e8e46422fd96de64/b6e0c/mdn.jpg","srcSet":"/static/377d8b408af8c1a5e8e46422fd96de64/f836f/mdn.jpg 200w,\n/static/377d8b408af8c1a5e8e46422fd96de64/2244e/mdn.jpg 400w,\n/static/377d8b408af8c1a5e8e46422fd96de64/b6e0c/mdn.jpg 760w","sizes":"(max-width: 760px) 100vw, 760px"}}}}},"previous":{"fields":{"slug":"/Reducing-costs-with-AWS-Lambda/"},"frontmatter":{"title":"AWS Lambda로 비용 92% 줄이기"}},"next":null},"pageContext":{"id":"649b3862-bda8-5aab-8e98-ddab8c01b023","previousPostId":"5e864611-e7bf-58d6-a512-93171ca477d9","nextPostId":null}},"staticQueryHashes":["3000541721","3274528899"],"slicesMap":{}}