{"componentChunkName":"component---src-templates-blog-post-js","path":"/Reducing-costs-with-AWS-Lambda/","result":{"data":{"site":{"siteMetadata":{"title":"reungoh's log"}},"markdownRemark":{"id":"5e864611-e7bf-58d6-a512-93171ca477d9","excerpt":"'서버리스' 라는 개념을 몰랐다. 서비스가 요청을 처리하기 위해서는 서버가 상시 열려 있는 것이 당연했다. 입사 후 얼마되지 않아 서버리스를 처음 알게되었다. S3에 업로드 된 최대 200개의 pdf 파일과 이미지, 그 외 사용자의 첨부파일을 zip…","html":"<p>'서버리스' 라는 개념을 몰랐다. 서비스가 요청을 처리하기 위해서는 서버가 상시 열려 있는 것이 당연했다.<br>\n입사 후 얼마되지 않아 서버리스를 처음 알게되었다. S3에 업로드 된 최대 200개의 pdf 파일과 이미지, 그 외 사용자의 첨부파일을 zip 파일로 제공해야 하는 기능이 필요했다. 팀 선배는 이 기능이 자주 사용되는 메인 기능은 아니지만, 동시에 여러 요청이 있을 때 WAS의 부담을 줄이고 자동 스케일업 가능한 람다로 처리하는것이 효율적이라고 말해주었다. 그리고 해당 기능은 지금까지 람다로 서비스하고 있다.</p>\n<h6>개인 프로젝트에 Lambda를 적용한 이유</h6>\n<p>서버리스 아키텍쳐를 알게된 이후 가장 와 닿았던 것은 사용한 만큼만 비용을 지불한다는 점이였다.\r\n2020년 12월 부터 운영중인 개인 프로젝트가 있는데, 프리티어 기간을 이용해 1년씩 유지해오다 과금이 되기 시작할 때엔 매달 34달러 정도가 청구되었다. 이마저도 DB는 AWS의 다른계정에 프리티어를 이용했다. 지도 위에서 철봉의 위치를 등록하고 조회하는 간단한 서비스이다. 제법 사용자들이 많고 블로그나 카페, 커뮤니티에서도 꽤 언급된다. 서비스를 종료하기엔 아쉬웠다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1369fefb20ae0b84c65dab46144e4811/f0685/old_architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABU0lEQVR42nVRO07DQBD1HTgDR+Ei3ICKGkpA9FBQUNBQ0ICEOACiQVBQEEURRnJwghMnsb3r3Z3PMuuVkMNn9DSeXfvNm3lOEJH/Ce/9n/dEJK+UbhNEYvIcjl0QMIE8p3U+LF7lQ+uUQ+PQRViwAiRQ2iSxTT+i5qTO3+ajcPTsfwUx1lonRlE55qbkKEufz1wOpAR0oatZ0vTRq0nkyIpFYaoK2FOtVDJ8ao63329OchlXzbLZwWZ5utVWi6pZNcD1y3Wxt7G822/BW6Pn8+YtbcaZZo+BnI3qi6PBw20e1FSVnu+Orw4ZnAMryiYfpmc75f1ltw8Zg4uFXa1kqI7c31lGL4Oillq8oeArpdlHa2zPkYBAlp0jmddM4UgOfMLWaEBAwgixSrIj+1N53U9xD5DDnwyEHkBaeFRtmxgr64kKhPxddBniTVf0EQhIVa2+AM75PtEQE+ncAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"old_arch\"\n        title=\"\"\n        src=\"/static/1369fefb20ae0b84c65dab46144e4811/f058b/old_architecture.png\"\n        srcset=\"/static/1369fefb20ae0b84c65dab46144e4811/c26ae/old_architecture.png 158w,\n/static/1369fefb20ae0b84c65dab46144e4811/6bdcf/old_architecture.png 315w,\n/static/1369fefb20ae0b84c65dab46144e4811/f058b/old_architecture.png 630w,\n/static/1369fefb20ae0b84c65dab46144e4811/f0685/old_architecture.png 835w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>UI는 리액트, API는 스프링부트를 사용했다. postgresDB를 사용했고, 자동빌드/배포를 위해 Jenkins를 사용했다. 하나의 EC2 인스턴스 위에 리액트와, 스프링, 젠킨스를 올렸고, ALB를 통해 포트번호로 요청을 나누어 처리했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6830736198d5bcb814025cc6a49a7af6/d2c2a/old_cost.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABQ0lEQVR42pVTi26EMAzr///k2EZ53PFsy6Nw4MVhSCdOk3ZIFiGkie2AaeoG1mZIbYo8z5FlArmXRYE0tfhIPtG4gBjjC5ZlQd00qKoabdvBOQfjQ0DbdfA+YJomjOOomMYjDvI+Lisej8cLWO+cl5pBY8KEYZADC/Z9x7sXWbJx1/VIkkSJGTJjU+e9sPQ6sRfqAwdd5BHPOTYjkVlinqEiw4Cy2ZRg7GQIG54yWMhh56EzTzu6vpeGM1axZRSbTNO2yoqFg2DbN+zbhu0J6yrF0oBDyOrMj/JMuXGeZaDT2JTlTbZbHChKnaIMpOgZlEVcc7SBRFJrdeOGK6/k05ml4OrXFfGPXFwi7vfqWEomrKzNca8q9XD4lf4uvr6/VaGp61q7q+HTqFt7F/STSg8Pbzf9M66fxH/BcyF4WOnR9w4/gKVU7OYrNX4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"old_cost\"\n        title=\"\"\n        src=\"/static/6830736198d5bcb814025cc6a49a7af6/f058b/old_cost.png\"\n        srcset=\"/static/6830736198d5bcb814025cc6a49a7af6/c26ae/old_cost.png 158w,\n/static/6830736198d5bcb814025cc6a49a7af6/6bdcf/old_cost.png 315w,\n/static/6830736198d5bcb814025cc6a49a7af6/f058b/old_cost.png 630w,\n/static/6830736198d5bcb814025cc6a49a7af6/d2c2a/old_cost.png 929w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>ELB와 EC2비용이 크다. 무언가 이상하다. 하루라도 빨리 서비스를 배포하고 싶었다. '선 구현 후 이해' 도 아닌 '선 구현 끝' 이었다. 외부에서 접속 되고 잘 돌아가니, 방치해 두었다. 그리곤 점점 낭비가 너무 크다는 들었다. 긴 연휴가 있었고 비용을 줄여보자 결심했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b315e11bf32a65e244913f3d3c030182/f0685/new_architecture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABy0lEQVR42m0Su24TQdA1f0Cd76ClpafLD0AFBXUk01IEhASiAAkJYYjEIyAUBSE5cRBWpCSEIollnHPgMGd8yt3e7szsLLO7Z5ugzI3mZnbej4a1LF8AnmIk/4hzfmrKXGnTcM6xdcxuDhyw5kXDfEZdgwFoZEN8e3fSWTklsmJ7cmCeN8fdd4VzJBbbg3Zz9dpm70Md54wzNr5/K5qLO09uH2qtnYO9zu9bV7ZfLPdFK/lbnx9fWlp4uvlArKXk/53B2N5+liZFfCpOTbd99DPJozia/PrYXUtGx+dnDj8jMxBmo/8prybskNgAeSSLzloiiKJBozEwpGtnrY0lP8hedgAEMckMzhV9FAPeGQDiuiRnntpOS/V3wIUN0HBLr93Ao/ex4kE6Wen0gZgYamdEH6dUCp3a2/hz8/Ju6440qRS58fq9wfUL2ZulKgzr0euti1fvD8dKwlY6OIdKpFEUkv1QLx/ufv2Sxn3r0XGy/kydHMbMSTp+1d4HssToM896QUtgfbVkK2ac3Yv2J1jP2feGWoghU1/Y1I6RUcYrHQUa0IJlyQS1yEHLiAz+wgpVlUoLBkZQFaUSpgjomXL+4g1K/6IqnefFX3s23/byJdp1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"new_arch\"\n        title=\"\"\n        src=\"/static/b315e11bf32a65e244913f3d3c030182/f058b/new_architecture.png\"\n        srcset=\"/static/b315e11bf32a65e244913f3d3c030182/c26ae/new_architecture.png 158w,\n/static/b315e11bf32a65e244913f3d3c030182/6bdcf/new_architecture.png 315w,\n/static/b315e11bf32a65e244913f3d3c030182/f058b/new_architecture.png 630w,\n/static/b315e11bf32a65e244913f3d3c030182/f0685/new_architecture.png 835w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>리액트 소스는 S3에 업로드 했고, REST API 요청은 aws api-gateway가 lambda를 호출해 처리한다. 서버리스 noSQL DB인 dynamoDB를 사용했다. 적용하는 데에 몇가지 이슈들이 있었지만 2일 정도가 소요 되었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6a866ac56aa1aee237f3e34889f4482b/23266/new_cost.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.81012658227847%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABtklEQVR42p1TibKCQAzb//9JFWG5Ebl3UfuS4jnPd6AzGWCFNmlSU5SlhGEkkbUSRVasjSWOE0mTRHbbnWy3gdTtIM65tyjLSoqikkN9lPp4FNP3vdR44HUcRxmGUa/LfY9zFPOznE6nb+A7TdNI13UyTpMMeDZN28o0Ofnk57wTP3stuNlswbJeCnZg17adomlaUG+UmfcPad57xe15cpOyPJ/P+h6ZUqU5QneLDm3Xo1O/3KMJCz6kD3rGd29nBJnVYDVBLpuRmCmrSrXzx26XywLe3zDPsxYgg/s5Z4hGLDijGBmqKWmWS5Jm0kCuwx93Buj6jEllutczgN+QEFNCciYvCmF0aD+tf57XM9wV7874TZZliyk2jsUidzSi6zvtth6D7IK9pFAKhqVKphl0zWNea0GW1iZQepWc5bkwPhqH62zWYZQ4SXR0huySNJXqcFgG/2TAfzEik1xfElOXub90lvH4aWd/A0Me7DFD1DKsWkB2BcvL6qCbwlVcK5mGMCmmgCnUnrMwruz2LjZ/gSpZy0SIzT4MkaOl4Cex6bExWiO/Sg6j6CWka0B23PNdEKjkLw7bJEuXAtqyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"new_cost\"\n        title=\"\"\n        src=\"/static/6a866ac56aa1aee237f3e34889f4482b/f058b/new_cost.png\"\n        srcset=\"/static/6a866ac56aa1aee237f3e34889f4482b/c26ae/new_cost.png 158w,\n/static/6a866ac56aa1aee237f3e34889f4482b/6bdcf/new_cost.png 315w,\n/static/6a866ac56aa1aee237f3e34889f4482b/f058b/new_cost.png 630w,\n/static/6a866ac56aa1aee237f3e34889f4482b/23266/new_cost.png 923w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>적용후 청구금액은 6.9 달러로 줄었다. 여기에 WAF와 삭제하지 않은 EC2비용이 포함되었는데 지금은 WAF를 사용하지 않고, EC2인스턴스를 완전히 삭제했다. 다음달 예상비용은 2.5 달러 내외로 예상되며\r\n처음 청구되던 34 달러와 비교해 무려 92% 의 비용이 줄었다.<br>\n앞으로도 서비스를 종료할 생각은 없고, 월 4만5천원, 연 50만원이 넘는 금액이었는데, 이젠 한달에 커피 한잔 값으로 서비스를 유지할 수 있다. 너무 기뻤다. 아동 한명을 더 후원할 수 있는 금액이다.</p>\n<h6>AWS Lambda의 이점</h6>\n<p>lambda를 선택한 가장 큰 이유는 온디멘드로 가격이 책정되어 사용한 만큼만 비용을 지불할 수 있다는 점이었다. 그리고 두번쨰로 꾸준하지만 트래픽이 많은 서비스가 아니다. 마지막으로 cold start로 발생하는 지연이 서비스 품질을 저해할 수준이 아니었다.</p>\n<h6>앞으로</h6>\n<p>부끄러운 점이지만 새로운 것을 공부하지 않는다. 알고 있는 것들로 문제를 해결하는데 익숙하다. 하루 또는 일주일 동안 맡겨진 과업들을 정해진 기간내에 끝내는 것에만 급급하다. 어떤 방법으로 개발했을 때 효율적일지 더 나은 방법이 있을지 잘 고민하지 않는다. 업무 외 공부할 시간이 없다고 생각했다.<br>\n이 프로젝트만 봐도 2년 넘게 기술부채가 쌓여왔고, 알고 있어도 개선하지 않았다. 조금 더 관심을 기울였다면 애초에 더 나은 설계를 할 수 있었다.<br>\n그나마 위안을 삼는것은 그떄와 지금의 관심사가 달라졌을 것이라는 점이다. 그때엔 개발에만 집중했다면, 지금은 아키텍쳐에도 관심을 갖게 되었다는 것, 더디지만 그때 보다는 지금이 나아졌을 것이라는 점이다.<br>\n새로운 것을 공부하는것에 익숙해져야겠다. 같이 일하는 선배가 말해주는 '그냥그런 개발자'로 머물러 있든지 아니면 조금 다른 개발자가 되기 위해 공부하든지</p>","frontmatter":{"title":"AWS Lambda로 비용 92% 줄이기","date":"December 10, 2023","description":"AWS Lambda","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE10lEQVR42m3UaVDUdRzH8T83C8uxy3KoIGIyTdM4qaPNNPWscRof1EyOV6QBIvd9LizIKaKCihJpmZPO1AOtxJLKyetBPSsO5WY59oRd2IvDrGx693OXyhl98H+4r/l8v9/P/iSTJgpzhZyZqhAsGjnWmmDma+XYGuTYm4JxNgfhOhrEQksgi8cDWG7152GbH49O+fF7uy9/nPXh8Yc+/NXpzd/nvJAMlVEYy+SY1SHMVMqZrRaoJhBrlcS8RsJWI2GvlXAe8fegx/xZPuFBfzvlK1AfN/pnh7dABaiviMZQEoKxPNSDqoOwNERjP7MFx9nNOD/chOujzThaFCtogEj6fPSxQCVdWTS6olAMpWGY1AqMhRKurmKW7x5joSuHxeu5PLxTz8ObpdgPSyvj/4v6PYNK06UxTBeGoi8Ow1CuxJAvxusqESk3YM6RsKh9sZZJLN+qFWlfwVHvJVCZB30yfqtATz7ZqQeVJotXMZUfJtBw9KVK9LkC/KYS++U9WE9sxHI4AkuFF45zr7N8swKb2KujORhXc8Bzx5cmClczkRvOVIGC6SIFurwALGfexHm9nMXbx3B+mcVsuTeWKvHD2w04Tr+ErdZb7FMmvmdRSZu/Gm12OBN5CpE03IPmB6LL9Uaf7SXQ41hbEpkpEsk+2c5SdwlzanH5JjmOpkCRNPD/8QUqjeetYTxLgTZH6UELwt07NVbHY+nYzlznDpxf52MS4GxVsDjWUWzHE5iv8cXeGITjyFOoSCqN5qxhNEPJeHaEG50sUDGZ6Yfl4908mvgZU/2LuH5oZLZxvRu1X3ybhWs5WCtERxtCBCpbQT3jSyNZsYwcihCoSiSNcI8/JQ5l/7aemdNvYb+Sj7VjB44rWe5KzWjCWLrTwnxzLHPVAdjqg7A3yP4bXxrOiGPoYIRAVYxlRTGa4sfM+fexXkpHmyz2dqMBc8s2XN83Yj4ch1HUyn5pF66raVjKxb+pIZz5p1BpMH0tgykqhtMi3UnHMlXYv2tjsnQd46kiUecurBf2Yel8B9vnBzGIWpk1ESzda8NSqxQNkJirDcZW50GlgbS1DCSrGEqLYSApAMPp3cxeynMnHU8Pwna9DmPTVnGoMFy3TmJUR7vLb7u4k+WfOnB+kYS1WuZBRVLpQWo89w9EMpASxWCykvnuU2jLXmYkRYau/jVsXfVoMwKZyPRl7nIac5/uE131wVSpxNK6haW7J0T5w7G4UQH2J6+jf38MfXuCmWp5F+P5TO7vlBh8z4u5r+rQNb3B+CGZu/y68lhcP7ahKwwWPfVCn+eL64aG2VqVqJTM/fRJfQfW0Ze0it7d4j281spcdzvmz4qxdrVgvVLNSKqc8ZxItLkqtOn+WC7sZ+FOO/arhTi761i8146pYuXpE++p1LM/gZ69MfQmxfAgfQMjJVsZK9vGuPpVhjNixKGUjIpDja309ElSQ91GsddNmJrFVx238p6GCjQE6dd98fyyK5KePVH07o2gd08o/XtDuJ8UwuAHCoZSlYykKRg9pBANCBc9DfPsNCuAqRx/dAUy9CVygQZjKhcj96ZupOdAIn3JifSnJvIgLZEBkXQw8wWGstYznJ3AaG4CY/miRgXxTBTFM1kSz1RZPNMVa9Gr4zBUxWLUrMFcs5p/AB9l8giGqVxiAAAAAElFTkSuQmCC","aspectRatio":1,"src":"/static/ad38815655c25e8c206dfea8d9bbc477/e93da/aws_lambda.png","srcSet":"/static/ad38815655c25e8c206dfea8d9bbc477/69585/aws_lambda.png 200w,\n/static/ad38815655c25e8c206dfea8d9bbc477/e93da/aws_lambda.png 351w","sizes":"(max-width: 351px) 100vw, 351px"}}}}},"previous":null,"next":{"fields":{"slug":"/load-event-and-ngOninit/"},"frontmatter":{"title":"load, ngOnInit 의 호출 순서"}}},"pageContext":{"id":"5e864611-e7bf-58d6-a512-93171ca477d9","previousPostId":null,"nextPostId":"649b3862-bda8-5aab-8e98-ddab8c01b023"}},"staticQueryHashes":["3000541721","3274528899"],"slicesMap":{}}